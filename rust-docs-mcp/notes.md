# Rust Docs MCP - Research Notes

[← Back to Index](./index.md)

---

## Research Findings

### docs.rs Analysis

**Site Technology:**

- Static HTML documentation generated by rustdoc
- No JavaScript required for content
- Clean semantic HTML structure
- Full API documentation for all crates

**URL Patterns:**

| Content Type | URL Pattern                                                           |
| ------------ | --------------------------------------------------------------------- |
| Crate root   | `https://docs.rs/{crate}/{version}/{crate_path}/`                     |
| Module       | `https://docs.rs/{crate}/{version}/{crate_path}/{module}/`            |
| Struct       | `https://docs.rs/{crate}/{version}/{crate_path}/struct.{Name}.html`   |
| Enum         | `https://docs.rs/{crate}/{version}/{crate_path}/enum.{Name}.html`     |
| Trait        | `https://docs.rs/{crate}/{version}/{crate_path}/trait.{Name}.html`    |
| Function     | `https://docs.rs/{crate}/{version}/{crate_path}/fn.{name}.html`       |
| Macro        | `https://docs.rs/{crate}/{version}/{crate_path}/macro.{name}.html`    |
| Type Alias   | `https://docs.rs/{crate}/{version}/{crate_path}/type.{Name}.html`     |
| Constant     | `https://docs.rs/{crate}/{version}/{crate_path}/constant.{NAME}.html` |

**Note:** Crate path uses underscores (e.g., `tauri-plugin-fs` → `tauri_plugin_fs`)

**Confirmed Static:** Successfully scraped `https://docs.rs/tauri/latest/tauri/` with Firecrawl - full content returned, no JS rendering needed.

### crates.io API

**Endpoint:** `https://crates.io/api/v1/crates`

**Search Example:**

```bash
curl "https://crates.io/api/v1/crates?q=tauri&per_page=5"
```

**Response Structure:**

```json
{
  "crates": [
    {
      "name": "tauri",
      "description": "Make tiny, secure apps...",
      "max_version": "2.9.4",
      "downloads": 12345678,
      "documentation": "https://docs.rs/tauri"
    }
  ]
}
```

---

## Existing Rust Docs MCPs

### 1. laptou/rust-docs-mcp-server

- **GitHub:** https://github.com/laptou/rust-docs-mcp-server
- **Transport:** stdio only (local)
- **Runtime:** Bun
- **Tools (7):**
  1. `std_doc_lookup` - Standard library docs
  2. `crate_doc_lookup` - Crate documentation
  3. `search_crates` - Search crates.io
  4. `crate_info` - Crate metadata
  5. `local_crate_search` - Search Cargo.toml
  6. `generate_cargo_cmd` - Generate cargo commands
  7. `rust_syntax_help` - Rust syntax reference
- **Limitation:** Requires local installation via npx

### 2. 0xkoda/mcp-rust-docs

- **GitHub:** https://github.com/0xkoda/mcp-rust-docs
- **Transport:** stdio only (local)
- **Tools (3):**
  1. Fetch crate docs
  2. Format for readability
  3. Strip HTML
- **Limitation:** Requires local installation

### Our Differentiator

| Feature                  | laptou | 0xkoda | **Ours** |
| ------------------------ | ------ | ------ | -------- |
| Cloud-hosted             | ❌     | ❌     | ✅       |
| No local install         | ❌     | ❌     | ✅       |
| HTTP/SSE transport       | ❌     | ❌     | ✅       |
| Works in restricted envs | ❌     | ❌     | ✅       |
| Mastra Cloud deploy      | ❌     | ❌     | ✅       |

---

## HTML Parsing Strategy

### docs.rs Page Structure

```html
<main>
  <h1>Crate tauri</h1>
  <div class="docblock">
    <!-- Description and examples -->
  </div>

  <section id="modules">
    <h2>Modules</h2>
    <div class="item-table">
      <div class="item-row">
        <div class="item-left"><a href="async_runtime/">async_runtime</a></div>
        <div class="item-right">The singleton async runtime...</div>
      </div>
    </div>
  </section>

  <section id="structs">
    <h2>Structs</h2>
    <!-- Similar structure -->
  </section>
</main>
```

### Cheerio Parsing Example

```typescript
import * as cheerio from "cheerio";

function parseCrateOverview(html: string) {
  const $ = cheerio.load(html);

  return {
    description: $(".docblock").first().text().trim(),
    modules: $("#modules .item-left a")
      .map((_, el) => $(el).text())
      .get(),
    structs: $("#structs .item-left a")
      .map((_, el) => $(el).text())
      .get(),
    enums: $("#enums .item-left a")
      .map((_, el) => $(el).text())
      .get(),
    traits: $("#traits .item-left a")
      .map((_, el) => $(el).text())
      .get(),
    functions: $("#functions .item-left a")
      .map((_, el) => $(el).text())
      .get(),
    macros: $("#macros .item-left a")
      .map((_, el) => $(el).text())
      .get(),
  };
}
```

---

## Mastra App Structure

### Why Full Mastra App (Not Just MCP)?

Mastra Cloud deploys **full Mastra applications**, not standalone MCP servers. The MCPServer is registered within the Mastra instance:

```typescript
// src/mastra/index.ts
import { Mastra } from "@mastra/core/mastra";
import { MCPServer } from "@mastra/mcp";

const mcpServer = new MCPServer({
  name: "rust-docs-mcp",
  version: "1.0.0",
  tools: {
    /* ... */
  },
});

export const mastra = new Mastra({
  mcpServers: { "rust-docs": mcpServer },
});
```

### Directory Structure

```
src/
└── mastra/
    ├── tools/               # Each tool in its own file
    │   ├── search-crates.ts
    │   ├── get-crate-overview.ts
    │   ├── get-item-docs.ts
    │   └── list-modules.ts
    ├── lib/                 # Shared utilities
    │   ├── parsers.ts
    │   ├── cache.ts
    │   └── crates-io.ts
    └── index.ts             # Mastra entry point
```

---

## Mastra Cloud Deployment

### How It Works

1. **GitHub Integration:** Connect repo to Mastra Cloud
2. **Auto-Detection:** Scans for `src/mastra/index.ts`
3. **Build:** Runs `mastra build`
4. **Deploy:** Creates HTTP/SSE endpoints

### Endpoints Generated

| Endpoint                                    | Purpose            |
| ------------------------------------------- | ------------------ |
| `https://{project}.mastra.cloud/mcp`        | Streamable HTTP    |
| `https://{project}.mastra.cloud/sse`        | Server-Sent Events |
| `https://{project}.mastra.cloud/swagger-ui` | API documentation  |

### MCP Servers Page

Mastra Cloud's dashboard shows:

- API endpoints for HTTP and SSE
- IDE configuration snippets (Cursor, Windsurf, VS Code)
- Tool list with descriptions
- Usage statistics

---

## Caching Strategy

### In-Memory Cache with TTL

```typescript
interface CacheEntry<T> {
  data: T;
  expires: number;
}

const cache = new Map<string, CacheEntry<any>>();

async function getCached<T>(
  key: string,
  ttlMs: number,
  fetcher: () => Promise<T>
): Promise<T> {
  const cached = cache.get(key);
  if (cached && cached.expires > Date.now()) {
    return cached.data as T;
  }

  const data = await fetcher();
  cache.set(key, { data, expires: Date.now() + ttlMs });
  return data;
}
```

### Cache TTLs

| Content            | TTL       | Reason                  |
| ------------------ | --------- | ----------------------- |
| Crate search       | 5 minutes | Updates frequently      |
| Crate overview     | 1 hour    | Stable between releases |
| Item documentation | 1 hour    | Stable between releases |
| Module listing     | 1 hour    | Stable between releases |

---

## Performance Considerations

### Response Sizes

| Content Type   | Typical Size | Notes                     |
| -------------- | ------------ | ------------------------- |
| Crate overview | 10-50KB      | Includes feature flags    |
| Struct docs    | 5-30KB       | Methods, impls            |
| Enum docs      | 5-20KB       | Variants, methods         |
| Trait docs     | 10-40KB      | Required/provided methods |
| Module listing | 2-10KB       | Just names and links      |

### Optimization Strategies

1. **Selective Parsing:** Only extract needed sections
2. **Caching:** Reduce repeated fetches
3. **Parallel Requests:** When fetching related items
4. **Content Trimming:** Remove unnecessary whitespace

---

## Error Handling

### Common Errors

| Error         | Cause                     | Handling                     |
| ------------- | ------------------------- | ---------------------------- |
| 404 Not Found | Invalid crate/item        | Return helpful error message |
| Rate Limited  | Too many requests         | Retry with backoff           |
| Parse Error   | Unexpected HTML structure | Log and return partial data  |
| Network Error | Connection issues         | Retry with timeout           |

### Error Response Format

```typescript
{
  error: "Crate 'unknown-crate' not found on docs.rs",
  suggestion: "Did you mean 'serde' or 'tokio'?"
}
```

---

## Testing Plan

### Unit Tests

1. **Parser Tests:** Verify HTML parsing with sample pages
2. **Cache Tests:** Test TTL expiration and invalidation
3. **Schema Tests:** Validate input/output with Zod

### Integration Tests

1. **Live Fetches:** Test against real docs.rs pages
2. **Edge Cases:** Empty modules, deprecated items
3. **Error Cases:** Invalid crates, missing items

### MCP Protocol Tests

1. **Tool Discovery:** Verify tool listing
2. **Tool Execution:** Test all 4 tools
3. **Error Responses:** Verify error format

---

## Dependencies

```json
{
  "dependencies": {
    "@mastra/core": "latest",
    "@mastra/mcp": "latest",
    "zod": "^3.23.0",
    "cheerio": "^1.0.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "@types/node": "^22.0.0"
  }
}
```

---

## References

- [docs.rs](https://docs.rs/) - Rust crate documentation
- [crates.io API](https://crates.io/) - Crate search and metadata
- [Mastra MCP Docs](https://mastra.ai/docs/mcp/overview)
- [Mastra Cloud](https://mastra.ai/cloud)
- [MCP Specification](https://modelcontextprotocol.io/docs)
